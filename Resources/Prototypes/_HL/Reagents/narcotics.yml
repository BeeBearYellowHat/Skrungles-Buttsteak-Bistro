# Widow Narcotic System
# Three-stage synthesis: Bite -> Venom -> Widow (or Ruin if failed)
# With custom addiction system: WidowsCurse

# Stage 1: Bite - Safe gateway precursor
- type: reagent
  id: Bite
  name: reagent-name-bite
  group: Narcotics
  desc: reagent-desc-bite
  physicalDesc: reagent-physical-desc-viscous
  flavor: bitter
  color: "#4a0e4e"
  metabolisms:
    Narcotic:
      metabolismRate: 0.3
      effects:
      # Stronger than Dynamoxine alone (1.15 -> 1.2)
      - !type:MovespeedModifier
        walkSpeedModifier: 1.2
        sprintSpeedModifier: 1.2
      # Anti-jitter from Diphenhydramine
      - !type:GenericStatusEffect
        key: Jitter
        time: 8.0
        type: Remove
      # Enhanced stamina from stimulant combination
      - !type:GenericStatusEffect
        key: StaminaModifier
        component: StaminaModifier
        time: 15
        type: Add
      # Mild pain resistance from precursor effects
      - !type:GenericStatusEffect
        key: Adrenaline
        component: IgnoreSlowOnDamage
        time: 10
        type: Add
      - !type:PopupMessage
        type: Local
        visualType: Medium
        messages:
          - "bite-effect-calm"
          - "bite-effect-focused"
          - "bite-effect-alert"
          - "bite-effect-energy"
          - "bite-effect-hunger"
        probability: 0.2

# Stage 2: Venom - Dangerous combat precursor
- type: reagent
  id: Venom
  name: reagent-name-venom
  group: Narcotics
  desc: reagent-desc-venom
  physicalDesc: reagent-physical-desc-volatile
  flavor: metallic
  color: "#1a3d1a"
  metabolisms:
    Narcotic:
      metabolismRate: 0.2
      effects:
      # Major speed boost combining all precursors
      - !type:MovespeedModifier
        walkSpeedModifier: 1.4
        sprintSpeedModifier: 1.4
      # Superior stamina enhancement
      - !type:GenericStatusEffect
        key: StaminaModifier
        component: StaminaModifier
        time: 25
        type: Add
      # Pain immunity from combat focus
      - !type:GenericStatusEffect
        key: Adrenaline
        component: IgnoreSlowOnDamage
        time: 30
        type: Add
      # Resistance to stuns (minor)
      - !type:GenericStatusEffect
        key: Stun
        time: 5
        type: Remove
      # Resistance to knockdown
      - !type:GenericStatusEffect
        key: KnockedDown
        time: 5
        type: Remove
      - !type:PopupMessage
        type: Local
        visualType: Large
        messages:
          - "venom-effect-power"
          - "venom-effect-invincible"
          - "venom-effect-enhanced"
          - "venom-effect-bloodlust"
          - "venom-effect-rage"
          - "venom-effect-lethal"
        probability: 0.25
      - !type:GenericStatusEffect
        key: SeeingRainbows
        component: SeeingRainbows
        type: Add
        time: 8
        refresh: false
        conditions:
        - !type:ReagentThreshold
          min: 3
      - !type:AdjustReagent
        conditions:
        - !type:ReagentThreshold
          reagent: Addictine
          max: 15
        - !type:ReagentThreshold
          min: 4
        reagent: Addictine
        amount: 1.5
    Poison:
      metabolismRate: 0.1
      effects:
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 5
        damage:
          types:
            Poison: 2
            Asphyxiation: 1

# Stage 3A: Widow - Final product (successful synthesis)
- type: reagent
  id: Widow
  name: reagent-name-widow
  group: Narcotics
  desc: reagent-desc-widow
  physicalDesc: reagent-physical-desc-inky
  flavor: chaos
  color: "#000000"
  recognizable: false
  metabolisms:
    Narcotic:
      metabolismRate: 0.1
      effects:
      # Blood corruption effect
      - !type:ChangeBloodReagent
        bloodReagent: BloodBlack
        conditions:
        - !type:ReagentThreshold
          min: 1
      # Cleanup blood modification tracker when reagent is nearly gone
      - !type:DecrementBloodModificationTracker
        conditions:
        - !type:ReagentThreshold
          max: 0.01
      # Performance benefits
      - !type:MovespeedModifier
        walkSpeedModifier: 1.5
        sprintSpeedModifier: 1.5
      - !type:PopupMessage
        type: Local
        visualType: Large
        messages:
          - "widow-effect-predator"
          - "widow-effect-coldblood"
          - "widow-effect-hunter"
          - "widow-effect-abyssal"
          - "widow-effect-void"
          - "widow-effect-darkness"
          - "widow-effect-apex"
          - "widow-effect-wraith"
          - "widow-effect-demon"
        probability: 0.2
      - !type:ResetNarcolepsy
        conditions:
        - !type:ReagentThreshold
          min: 1
      - !type:GenericStatusEffect
        key: Stun
        time: 15
        type: Remove
      - !type:GenericStatusEffect
        key: KnockedDown
        time: 15
        type: Remove
      - !type:GenericStatusEffect
        key: StaminaModifier
        component: StaminaModifier
        time: 20
        type: Add
      - !type:GenericStatusEffect
        key: Adrenaline
        component: IgnoreSlowOnDamage
        time: 25
      # Treatment resistance
      - !type:AdjustReagent
        reagent: Charcoal
        amount: -8.0
      - !type:AdjustReagent
        reagent: Ipecac
        amount: -8.0
      # Balanced negative effects - Medium doses (6-12u)
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 6
        damage:
          types:
            Poison: 1
            Asphyxiation: 0.5
      - !type:AdjustTemperature
        conditions:
        - !type:ReagentThreshold
          min: 8
        amount: -800
      - !type:Jitter
        conditions:
        - !type:ReagentThreshold
          min: 10
      # High doses (13-20u) - Overdose territory
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 13
        damage:
          types:
            Poison: 5
            Asphyxiation: 3
            Caustic: 2
      - !type:Paralyze
        conditions:
        - !type:ReagentThreshold
          min: 15
        probability: 0.08
        paralyzeTime: 5
      - !type:PopupMessage
        conditions:
        - !type:ReagentThreshold
          min: 18
        type: Local
        visualType: LargeCaution
        messages:
          - "widow-overdose-psychosis-1"
          - "widow-overdose-psychosis-2"
          - "widow-overdose-psychosis-3"
          - "widow-overdose-hallucination-1"
          - "widow-overdose-hallucination-2"
          - "widow-overdose-hallucination-3"
          - "widow-overdose-abyssal-1"
          - "widow-overdose-abyssal-2"
        probability: 0.25
      # Extreme doses (21u+) - Lethal territory
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 21
        probability: 0.05
        damage:
          types:
            Asphyxiation: 25
      - !type:AdjustTemperature
        conditions:
        - !type:ReagentThreshold
          min: 23
        amount: -2000
      # Addiction system
      - !type:AdjustReagent
        conditions:
        - !type:ReagentThreshold
          reagent: WidowsCurse
          max: 50
        - !type:ReagentThreshold
          min: 3
        reagent: WidowsCurse
        amount: 3.5

# Stage 3B: Ruin - Failed synthesis (extremely nasty poison)
- type: reagent
  id: Ruin
  name: reagent-name-ruin
  group: Toxins
  desc: reagent-desc-ruin
  physicalDesc: reagent-physical-desc-putrid
  flavor: horrible
  color: "#1a0d1a"
  recognizable: true
  metabolisms:
    Poison:
      metabolismRate: 0.5
      effects:
      # Immediate devastating effects
      - !type:PopupMessage
        type: Local
        visualType: LargeCaution
        messages:
          - "ruin-effect-burning"
          - "ruin-effect-agony"  
          - "ruin-effect-regret"
          - "ruin-effect-freezing"
          - "ruin-effect-confusion"
          - "ruin-effect-nausea"
          - "ruin-effect-corruption"
          - "ruin-effect-madness"
          - "ruin-effect-void"
          - "ruin-effect-twisted"
        probability: 0.3
      # Base toxic effects from failed synthesis
      - !type:HealthChange
        damage:
          types:
            Poison: 8
            Caustic: 5
            Asphyxiation: 3
      # Corrupted Abyssal Blood - extreme hypothermia  
      - !type:AdjustTemperature
        amount: -1000
      # Corrupted Artifexium - reality distortion/confusion
      - !type:GenericStatusEffect
        key: Drunk
        component: Drunk
        time: 10
        type: Add
        probability: 0.4
      # Corrupted Phalanximine - severe nausea instead of healing
      - !type:ChemVomit
        probability: 0.4
      # Corrupted Venom - uncontrolled jitters instead of enhancement
      - !type:Jitter
        time: 15
      # Progressive damage (2u+)
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 2
        damage:
          types:
            Poison: 15
            Caustic: 8
            Cold: 4
            Cellular: 2
      # Corrupted Leporazine - complete temperature regulation failure
      - !type:AdjustTemperature
        conditions:
        - !type:ReagentThreshold
          min: 2
        amount: -1500
      # Enhanced confusion from concentrated Artifexium corruption
      - !type:GenericStatusEffect
        conditions:
        - !type:ReagentThreshold
          min: 3
        key: Dizzy
        component: Dizzy
        time: 20
        type: Add
      # Catastrophic effects (5u+)
      - !type:ChemVomit
        conditions:
        - !type:ReagentThreshold
          min: 5
        probability: 0.8
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 5
        damage:
          types:
            Poison: 25
            Caustic: 15
            Asphyxiation: 10
      # Complete system failure - paralysis from corrupted synthesis
      - !type:Paralyze
        conditions:
        - !type:ReagentThreshold
          min: 8
        probability: 0.25
        paralyzeTime: 8

# Addiction Chemical: WidowsCurse
- type: reagent
  id: WidowsCurse
  name: reagent-name-widows-curse
  group: Biological
  desc: reagent-desc-widows-curse
  physicalDesc: reagent-physical-desc-viscous
  flavor: bitter
  color: "#2d0a2d"
  recognizable: false
  metabolisms:
    Poison:
      metabolismRate: 0.01
      effects:
      # Blood corruption effect
      - !type:ChangeBloodReagent
        bloodReagent: BloodBlack
        conditions:
        - !type:ReagentThreshold
          min: 1
      # Cleanup blood modification tracker when reagent is nearly gone
      - !type:DecrementBloodModificationTracker
        conditions:
        - !type:ReagentThreshold
          max: 0.01
      # Enhanced withdrawal messages
      - !type:PopupMessage
        type: Local
        visualType: LargeCaution
        messages:
          - "curse-withdrawal-1"
          - "curse-withdrawal-2"
          - "curse-withdrawal-3"
          - "curse-withdrawal-4"
          - "curse-withdrawal-5"
        probability: 0.22
        conditions:
        - !type:ReagentThreshold
          reagent: Widow
          max: 0.01
      # Withdrawal blindness
      - !type:GenericStatusEffect
        key: TemporaryBlindness
        component: TemporaryBlindness
        conditions:
        - !type:ReagentThreshold
          min: 8
        - !type:ReagentThreshold
          reagent: Widow
          max: 0.01
        time: 20
      # Worse movement penalties than Addictine
      - !type:MovespeedModifier
        walkSpeedModifier: 0.85
        sprintSpeedModifier: 0.5
        conditions:
        - !type:ReagentThreshold
          min: 3
        - !type:ReagentThreshold
          reagent: Widow
          max: 0.01
      # Stronger treatment resistance than Addictine
      - !type:AdjustReagent
        reagent: Charcoal
        amount: -12.0
      - !type:AdjustReagent
        reagent: Ipecac
        amount: -12.0
      # Withdrawal physical damage
      - !type:HealthChange
        conditions:
        - !type:ReagentThreshold
          min: 15
        - !type:ReagentThreshold
          reagent: Widow
          max: 0.01
        damage:
          types:
            Asphyxiation: 1
            Poison: 0.5